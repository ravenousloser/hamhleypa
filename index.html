<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HAMHLEYPA</title>
  <link rel="icon" href="icons/agothic_black.png" type="image/x-icon" />
  <link rel="stylesheet" href="index.css" />
  <style>
    body, .hero-section {
      background-color: #8174C8;
      transition: background-color 0.6s ease;
    }
  </style>
</head>
<body>
  <header class="main-header">
    <a href="index.html" class="home-link logo-text">hamhleypa</a>
  
    <!-- Hamburger menu button (visible on mobile) -->
    <button class="hamburger" aria-label="Menu">‚ò∞</button>
  
    <!-- Mobile menu (toggle visibility with JS) -->
    <nav class="mobile-menu">
      <a href="#hero-section">heim</a>
      <a href="#about-hover-section">um hamhleypu</a>
      <a href="#glyph-section">leturs√Ωni</a>
      <a href="#" class="lang-switch">en</a>
    </nav>
  
    <!-- Dropdown menu (for desktop) -->
    <div class="dropdown-container">
      <div class="dropdown" id="dropdown">
        <button class="dropdown-button">
          <span class="dropdown-title">Menu Item</span>
          <span class="arrow">‚ñº</span>
        </button>
        <div class="dropdown-menu">
          <div class="dropdown-item" data-section="hero-section">heim</div>
          <div class="dropdown-item" data-section="about-hover-section">um hamhleypu</div>
          <div class="dropdown-item" data-section="glyph-section">leturs√Ωni</div>
    
        </div>
      </div>
    </div>
    <nav class="nav-menu spaced-nav">
      <a href="#" class="lang-switch">en</a>
    </nav>
  </header>

  <main id="snapContainer" class="snap-container">
  <section id="hero-section" class="hero-section">
    <div class="text-wrapper">
      <div id="textInput" class="text-input empty" contenteditable="true" spellcheck="false" data-placeholder="hver ert √æ√∫ √≠ dag?"></div>
    </div>

    <div class="bottomControls">
      <div class="icon-container">
        <img id="toggleButton" class="icon-btn" src="icons/agothic_black.png" alt="Toggle Italic" />
        <img id="quietModeBtn" class="quiet-mode-button" src="icons/quiettoggle_bw.png" alt="toggleQuietMode">
      </div>
    
      <div class="slider-container">
        <div class="slider-box">
          <label for="italicSlider">hamskipti</label>
          <input type="range" id="italicSlider" class="slider" min="0" max="400" value="0" step="1">
        </div>
      </div>
    
      <div class="button-wrapper">
        <button id="randomizeButton" class="randomization-button hidden">hamleikur</button>
      </div>    
      </div>
    </section>

    <section id="about-hover-section" class="about-hover-section dark-bg">
      <div class="about-word-wrapper">
        <div id="aboutWord" class="about-word"></div>
      </div>
    </section>
    

  <section id="glyph-section" class="glyph-section dark-bg">
    <div class="big-letter" id="bigLetter">a</div>
    <div class="grid-container">
      <div class="letter-grid" id="letterGrid"></div>
    </div>
    <div class="icon-glyph-container">
      <img src="icons/agothic_white.png" alt="Toggle Font Weight" class="icon-glyph-toggle-font" />
    </div>
  </section>

  <audio id="sliderAudio" src="video/gregor.mp3" preload="auto"></audio>
  <audio id="hamleikurSound" src="video/churchbells.mp3" preload="auto"></audio>
  <div id="screensaver">
    <video id="screensaverVideo" autoplay loop muted>
      <source src="video/hamhleypa_video.mp4" type="video/mp4">
      Your browser does not support the video tag.
    </video>
    </div>

<section id="radius-hover-section" class="radius-hover-section dark-bg">
  <div class="radius-word-wrapper">
    <div id="radiusWord" class="radius-word"></div>
  </div>
</section>

  <!-- ‚úÖ Fixed mini-type-tester section -->
  <section id="mini-type-tester" class="mini-type-tester-section dark-bg">
    <div class="type-tester">
      <div class="controls-row">
        <div class="control-group">
          <label id="label-ital">hamur
            <input type="range" id="ital" min="1" max="400" step="1" value="1">
          </label>
          <label id="label-tracking">stafabil
            <input type="range" id="tracking" min="-0.1" max="0.5" step="0.01" value="0">
          </label>
          <label id="label-leading">l√≠nubil
            <input type="range" id="leading" min="0.2" max="2.5" step="0.1" value="1.5">
          </label>
          <div class="color-wrapper">
            <span class="color-label" id="label-color">litur</span>
            <div class="custom-color-display" id="colorSwatch">
              #ffffff
              <input type="color" id="color" value="#ffffff" />
            </div>
          </div>
        </div>
        <button id="resetButton" class="reset-button">endurstilla</button>
      </div>
      <div class="preview-container">
        <div class="tester-preview empty" id="textPreview" contenteditable="true" spellcheck="false" data-placeholder="man is not truly one but truly two."></div>
      </div>
    </div>
  </section>
  </main>



  
  
  <script>
    
    const textWrapper = document.querySelector('.text-wrapper'); // NEW!
    const randomizeButton = document.getElementById("randomizeButton");
    const toggleButton = document.getElementById("toggleButton");
    const sliderAudio = document.getElementById("sliderAudio");
    const quietModeBtn = document.getElementById("quietModeBtn");
    document.querySelectorAll(".lang-switch").forEach((el) => {
  el.addEventListener("click", (e) => {
    e.preventDefault();
    const newLang = currentLang === "is" ? "en" : "is";
    applyLanguage(newLang);
  });
});


    const sliderLabel = document.querySelector(".slider-box label");
    const navLinks = document.querySelectorAll(".nav-menu a");

    const textInput = document.getElementById('textInput');
    const sections = document.querySelectorAll('section');
    const dropdownButton = document.querySelector('.dropdown-button');




function updatePlaceholder() {
  if (textInput.innerText.trim() === "") {
    textInput.classList.add('empty');
  } else {
    textInput.classList.remove('empty');
  }
  const isEmpty = textInput.innerText.trim() === "";
  textInput.classList.toggle('empty', isEmpty);
  randomizeButton.classList.toggle('hidden', isEmpty); // üëà hide/show button
}

function applyFontVariationToAllChildren(ital) {
  const allSpans = textInput.querySelectorAll('*');
  allSpans.forEach(el => {
    if (el.nodeType === 1) {
      el.style.fontVariationSettings = `"ital" ${ital}`;
    }
  });
}



function fitTextSize() {
  let fontSize = 600; // Start BIG (600px)
  const minFontSize = 40;
  const wrapperHeight = textInput.parentElement.clientHeight;

  textInput.style.fontSize = fontSize + "px";

  while (textInput.scrollHeight > wrapperHeight && fontSize > minFontSize) {
    fontSize -= 5;
    textInput.style.fontSize = fontSize + "px";
  }
}
textInput.addEventListener('focus', () => {
  if (textInput.classList.contains('empty')) {
    
    textInput.innerHTML = '&nbsp;'; // Clear it immediately
    textInput.classList.remove('empty');
    updateFont(); // <--- ADD THIS

    fitTextSize();
  }
});


textInput.addEventListener('input', () => {
  updatePlaceholder();
  fitTextSize();

  const hasText = textInput.innerText.trim().length > 0;
  randomizeButton.classList.toggle('hidden', !hasText);
});

textInput.addEventListener('blur', () => {
  updatePlaceholder();
  if (textInput.innerText.trim() === "") {
    randomizeButton.classList.add('hidden');
  }
});


window.addEventListener('load', () => {
  updatePlaceholder();
  fitTextSize();
  if (textInput.innerText.trim() === "") {
    randomizeButton.classList.add('hidden');
  }
});


    let isItalic = false;
    let wasRandomized = false;

    let pendingItal = null;
let animationFrameRequest = null;

function smoothUpdateFont() {
  if (pendingItal === null) return;

  const ital = pendingItal;
  textInput.style.fontVariationSettings = `"ital" ${ital}`;

  // Update the background, color, glow, etc.
  updateFont(); // (Your existing updateFont logic)

  pendingItal = null;
  animationFrameRequest = null;
}

    
    const italicSlider = document.getElementById("italicSlider");

// Set the step size to 2 for smoother transitions
italicSlider.setAttribute("step", "1");

italicSlider.addEventListener("input", () => {

  const ital = parseInt(italicSlider.value, 10);
  textInput.style.fontVariationSettings = `"ital" ${ital}`;
  applyFontVariationToAllChildren(ital); // üî• force override of randomized spans
  updateFont();
});


function fadeAudioVolume(audioElement, targetVolume, duration = 300) {
  const startVolume = audioElement.volume;
  const startTime = performance.now();

  function step(now) {
    const elapsed = now - startTime;
    const progress = Math.min(elapsed / duration, 1);
    audioElement.volume = startVolume + (targetVolume - startVolume) * progress;

    if (progress < 1) {
      requestAnimationFrame(step);
    }
  }

  requestAnimationFrame(step);
}

function updateDropdownTitle() {
  const scrollY = snapContainer.scrollTop;  // ‚úÖ not window.scrollY
  const containerHeight = snapContainer.clientHeight;
  const middle = scrollY + containerHeight / 2;

  currentSectionId = null; // reset before scanning
  
  const sectionAliasMap = {
  'glyph-section': 'glyph-section',
  'radius-hover-section': 'glyph-section',
  'mini-type-tester': 'glyph-section',
};

  sections.forEach(section => {
    const sectionTop = section.offsetTop;
    const sectionBottom = sectionTop + section.offsetHeight;

    if (middle >= sectionTop && middle < sectionBottom) {
      const aliasId = sectionAliasMap[section.id] || section.id;
currentSectionId = aliasId;

    }
  });

  if (currentSectionId) {
    const translatedTitle = getTranslatedSectionTitle(currentSectionId, currentLang);
    dropdownButton.innerHTML = `${translatedTitle} <span class="arrow">&#9660;</span>`;
  }
}

let lastSliderAudioTime = 0;
let lastItalValue = 0;

function updateFont() {
  const ital = parseInt(italicSlider.value, 10);
  const now = Date.now();
  const isPastMid = ital > 200;
  const isQuiet = document.body.classList.contains('quiet-mode');
  const shouldUsePastMidEffects = isPastMid && !isQuiet;
  
  const heroSection = document.querySelector('.hero-section');
  if (isQuiet) {
  sliderAudio.pause();
  sliderAudio.currentTime = 0;
  sliderAudio.volume = 0;
  hamleikurSound.volume = 0;
} else {
  if (ital <= 200) {
    sliderAudio.volume = 0; // Mute but keep playing
    if (sliderAudio.paused) {
      sliderAudio.play();
    }
  } else {
    sliderAudio.volume = 1; // Full volume
    if (sliderAudio.paused) {
      sliderAudio.play();
    }
  }
}

  lastItalValue = ital;

  // (rest of your updateFont function ‚Äî background, text colors etc)


  // Background color
  if (isQuiet) {
    heroSection.style.backgroundColor = "#d9d9d9";
  } else {
    heroSection.style.backgroundColor = isPastMid ? "#121212" : "#8174C8";
  }

  // Colors
  let sliderBg, thumbColor, randomizeButtonColor, randomizeButtonBg, textColor, accentColor;

  if (isQuiet) {
    sliderBg = "#121212";
    thumbColor = "#121212";
    randomizeButtonColor = "#d9d9d9";
    randomizeButtonBg = "#121212";
    textColor = "#121212";
    accentColor = "#121212";
  } else if (shouldUsePastMidEffects) {
    sliderBg = "#F30600";
    thumbColor = "#F30600";
    randomizeButtonColor = "#121212";
    randomizeButtonBg = "#F30600";
    textColor = "#8174C8";
    accentColor = "#F30600";
  } else {
    sliderBg = "#382C6A";
    thumbColor = "#121212";
    randomizeButtonColor = "#8174C8";
    randomizeButtonBg = "#121212";
    textColor = "#121212";
    accentColor = "#121212";
  }

  document.documentElement.style.setProperty('--thumb-color', thumbColor);
  italicSlider.style.background = sliderBg;
  randomizeButton.style.color = randomizeButtonColor;

  randomizeButton.style.backgroundColor = randomizeButtonBg;
  textInput.style.color = textColor;
  sliderLabel.style.color = accentColor;
  //navLinks.forEach(link => link.style.color = accentColor);

if (textInput.classList.contains('empty')) {
  if (isQuiet) {
    document.documentElement.style.setProperty('--placeholder-color', '#121212');
  } else if (ital >= 200) {
    document.documentElement.style.setProperty('--placeholder-color', '#8174C8');
  } else {
    document.documentElement.style.setProperty('--placeholder-color', '#121212');
  }
}


  // Remove glow immediately if below 400
  if (ital < 350 || document.body.classList.contains('quiet-mode')) {
  textInput.classList.remove("glow");
  textInput.style.textShadow = "none";
  clearTimeout(textInput._glowTimeout);
} else if (ital === 400) {
  clearTimeout(textInput._glowTimeout);
  textInput._glowTimeout = setTimeout(() => {
    if (!document.body.classList.contains('quiet-mode')) {
      textInput.classList.add("glow");
      textInput.style.textShadow = `0 0 8px rgba(129, 116, 200, 0.3),
                                    0 0 12px rgba(129, 116, 200, 0.3),
                                    0 0 20px rgba(129, 116, 200, 0.4),
                                    0 0 30px rgba(129, 116, 200, 0.2)`;
    }
  }, 0);
}
if (textInput.classList.contains('empty')) {
  document.documentElement.style.setProperty('--placeholder-ital', `"ital" ${ital}"`);
}


// ‚úÖ Make sure this runs for every ital value
updateHeaderAndIcons(ital);
}


    function buildAboutSentence(text) {
  const aboutWord = document.getElementById("aboutWord");
  const words = text.split(" ");
  words.forEach((word, i) => {
    const wordSpan = document.createElement("span");
    wordSpan.classList.add("word");
    wordSpan.style.display = "inline-block";
    wordSpan.style.whiteSpace = "nowrap";

    for (let char of word) {
      const charSpan = document.createElement("span");
      charSpan.classList.add("char");
      charSpan.textContent = char;
      wordSpan.appendChild(charSpan);
    }

    aboutWord.appendChild(wordSpan);
    if (i !== words.length - 1) {
      const space = document.createTextNode("\u00A0");
      aboutWord.appendChild(space);
    }
  });
}

function activateAboutHover(radius = 150) {
  const chars = document.querySelectorAll("#aboutWord .char");
  const container = document.getElementById("aboutWord");

  container.addEventListener("mousemove", (e) => {
    const mouseX = e.clientX;
    const mouseY = e.clientY;

    chars.forEach((char) => {
      const rect = char.getBoundingClientRect();
      const charX = rect.left + rect.width / 2;
      const charY = rect.top + rect.height / 2;

      const dist = Math.sqrt((mouseX - charX) ** 2 + (mouseY - charY) ** 2);
      char.style.fontVariationSettings = dist < radius ? "'ital' 400" : "'ital' 1";
    });
  });
}
buildAboutSentence(`hamhleypa er breytilegt letur sem tekur √° sig tv√¶r mismunandi myndir. √æa√∞ hefur √≠ raun tvo pers√≥nuleika. s√° fyrri er ge√≥metr√≠skt steinletur, sem er l√≠ti√∞ √≠ s√©r og heldur kunnuglegt. hinn s√¶kir innbl√°stur √∫r gotneskum st√≠l fr√° mi√∞√∂ldum evr√≥pu, n√°nar tilteki√∞ √≠ oddboga og mynstur sem finnast √≠ gluggafl√∫rum (tracery) gotneskra kirkna. hamhleypa er ‚Äûuniwidth‚Äú, sem √æ√Ω√∞ir a√∞ stafir letursins taka √°vallt jafn miki√∞ pl√°ss √≠ hvorum ham, og √° √∂llum skrefum √æar √° milli. √æa√∞ gerir hamhleypu s√©rstaklega noth√¶fa √≠ stafr√¶nu umhverfi.`);
activateAboutHover(150);


function updateIconsBasedOnState() {
  if (document.body.classList.contains('quiet-mode')) {
    return; // üîï Don‚Äôt change icons if in quiet mode
  }

  const ital = parseInt(italicSlider.value, 10);
  const isSliderMax = ital === 400;

  const newToggleIcon = isSliderMax ? "icons/aregular_red.png" : "icons/agothic_black.png";
  const newQuietIcon = isSliderMax ? "icons/quiettoggle_red.png" : "icons/quiettoggle_bw.png";

  if (toggleButton.getAttribute("src") !== newToggleIcon) {
    toggleButton.src = newToggleIcon;
  }

  if (quietModeBtn.getAttribute("src") !== newQuietIcon) {
    quietModeBtn.src = newQuietIcon;
  }
}

updateIconsBasedOnState();


function playHamleikurSoundThrottled() {
  if (document.body.classList.contains('quiet-mode')) return; // üö´ if quiet, exit early

  const audio = document.getElementById("hamleikurSound");
  if (!audio) return;

  const now = Date.now();
  if (!playHamleikurSoundThrottled.lastPlay || now - playHamleikurSoundThrottled.lastPlay > 1000) {
    const newAudio = audio.cloneNode(true);
    newAudio.volume = 1;
    newAudio.play();
    playHamleikurSoundThrottled.lastPlay = now;
  }
}



randomizeButton.addEventListener("click", () => {
  playHamleikurSoundThrottled();

  if (textInput.classList.contains('empty')) {
  const placeholderItal = Math.random() < 0.5 ? 1 : 400;
  document.documentElement.style.setProperty('--placeholder-ital', `"ital" ${placeholderItal}`);
}


  const rawText = textInput.innerText.trim();
  if (!rawText) return;

  textInput.innerHTML = '';
  wasRandomized = true;

  const words = rawText.split(/\s+/); // handle multiple spaces/tabs cleanly
  words.forEach((word, index) => {
    const wordSpan = document.createElement("span");
    wordSpan.style.display = "inline-block";
    wordSpan.style.whiteSpace = "nowrap"; // prevent word break

    const segmenter = new Intl.Segmenter(undefined, { granularity: "grapheme" });
const graphemes = Array.from(segmenter.segment(word));

for (const { segment } of graphemes) {
  const charSpan = document.createElement("span");
  charSpan.textContent = segment;
  const ital = Math.random() < 0.5 ? 1 : 400;
  charSpan.style.fontVariationSettings = `"ital" ${ital}`;
  charSpan.style.display = "inline-block";
  wordSpan.appendChild(charSpan);
}


    textInput.appendChild(wordSpan);

    if (index < words.length - 1) {
      const space = document.createTextNode(" "); // Normal space this time
      textInput.appendChild(space);
    }
  });

  textInput.style.fontVariationSettings = "unset";
});
italicSlider.addEventListener("input", () => {
  const ital = parseInt(italicSlider.value, 10);
  pendingItal = ital;

  if (!animationFrameRequest) {
    animationFrameRequest = requestAnimationFrame(smoothUpdateFont);
  }

  updateTextColorOnScroll(); // üëà this is enough!
});

function updateHeaderAndIcons(ital) {
  const isQuiet = document.body.classList.contains('quiet-mode');

  const header = document.querySelector('.main-header');
  const navLinks = document.querySelectorAll('.nav-menu a');
  const langSwitch = document.querySelector('.lang-switch');
  const logo = document.querySelector('.logo-text');
  const dropdownButton = document.querySelector('.dropdown-button');
  const dropdownItems = document.querySelectorAll('.dropdown-item');
  const iconGlyph = document.querySelector('.icon-glyph-toggle-font');

  if (isQuiet) {
    // üîá Quiet Mode: everything black or grayscale
    header.style.color = '#121212';
    logo.style.color = '#121212';
    langSwitch.style.color = '#121212';
    dropdownButton.style.color = '#121212';
    navLinks.forEach(link => link.style.color = '#121212');
    dropdownItems.forEach(item => {
      item.style.color = '#d9d9d9';
      item.style.backgroundColor = '#121212';
    });

    toggleButton.src = 'icons/agothic_black.png';
    quietModeBtn.src = 'icons/quiettoggle_bw.png';
    if (iconGlyph) iconGlyph.src = 'icons/agothic_white.png'; // or black depending on section
    return;
  }

  // üé® Not in quiet mode ‚Äî handle red/black states based on ital
  if (ital >= 200) {
    header.style.color = '#F30600';
    logo.style.color = '#F30600';
    langSwitch.style.color = '#F30600';
    dropdownButton.style.color = '#F30600';
    navLinks.forEach(link => link.style.color = '#F30600');
    dropdownItems.forEach(item => {
      item.style.color = '#121212';
      item.style.backgroundColor = '#F30600';
    });

    toggleButton.src = 'icons/agothic_red.png';
    quietModeBtn.src = 'icons/quiettoggle_red.png';
  } else {
    header.style.color = '#121212';
    logo.style.color = '#121212';
    langSwitch.style.color = '#121212';
    dropdownButton.style.color = '#121212';
    navLinks.forEach(link => link.style.color = '#121212');
    dropdownItems.forEach(item => {
      item.style.color = '#8174C8';
      item.style.backgroundColor = 'transparent';
    });

    toggleButton.src = 'icons/agothic_black.png';
    quietModeBtn.src = 'icons/quiettoggle_bw.png';
  }
}


    function toggleQuietMode() {
  document.body.classList.toggle("quiet-mode");
  updateFont();
  updateIconsBasedOnState();  // ‚úÖ add this after updateFont()

  const ital = parseInt(italicSlider.value, 10);
  if (!document.body.classList.contains('quiet-mode') && ital >= 200 && ital <= 400) {
    sliderAudio.currentTime = 0;
    sliderAudio.play();
  }
}

quietModeBtn.addEventListener("click", toggleQuietMode);


let inactivityTimeout;

function startInactivityWatcher() {
  const screensaver = document.getElementById("screensaver");
  const screensaverVideo = document.getElementById("screensaverVideo");

  function activateScreensaver() {
    screensaver.style.display = "flex";
    screensaverVideo.play();

    // üëá listen ONCE, then reload on any interaction
    function handleWake() {
      location.reload();
    }

    document.addEventListener("mousemove", handleWake, { once: true });
    document.addEventListener("keydown", handleWake, { once: true });
    document.addEventListener("touchstart", handleWake, { once: true });
  }

  function resetTimer() {
    clearTimeout(inactivityTimeout);
    screensaver.style.display = "none";
    inactivityTimeout = setTimeout(activateScreensaver, 30000);
  }

  ["mousemove", "keydown", "touchstart"].forEach(event =>
    document.addEventListener(event, resetTimer)
  );

  resetTimer(); // start the timer immediately
}

startInactivityWatcher();

const translations = {
  is: {
    hamleikur: "hamleikur",
    sliderLabel: "hamskipti",
    placeholder: "hver ert √æ√∫ √≠ dag?",

    dropdown: {
      "hero-section": "heim",
      "about-hover-section": "um hamhleypu",
      "glyph-section": "leturs√Ωni",
      
    },
    about: `hamhleypa er breytilegt letur sem tekur √° sig tv√¶r mismunandi myndir. √æa√∞ hefur √≠ raun tvo pers√≥nuleika. s√° fyrri er ge√≥metr√≠skt steinletur, sem er l√≠ti√∞ √≠ s√©r og heldur kunnuglegt. hinn s√¶kir innbl√°stur √∫r gotneskum st√≠l fr√° mi√∞√∂ldum evr√≥pu, n√°nar tilteki√∞ √≠ oddboga og mynstur sem finnast √≠ gluggafl√∫rum (tracery) gotneskra kirkna. letri√∞ er ‚Äûuniwidth‚Äú, sem √æ√Ω√∞ir a√∞ stafir letursins taka √°vallt jafn miki√∞ l√°r√©tt pl√°ss √≠ hvorum ham, og √° √∂llum skrefum √æar √° milli. √æa√∞ gerir letri√∞ s√©rstaklega noth√¶ft √≠ stafr√¶nu umhverfi. `,
    nav: ["en"],
    labels: {
      ital: "hamur",
      tracking: "stafabil",
      leading: "l√≠nubil",
      color: "litur",
      reset: "endurstilla",
    }
  },
  en: {
    hamleikur: "randomize",
    sliderLabel: "shapeshift",
    placeholder: "who are you today?",
    dropdown: {
      "hero-section": "home",
      "about-hover-section": "about",
      "glyph-section": "type specimen",
    },
    about: `hamhleypa is a typeface that takes on two different forms. it actually has two different personalities. the first is a geometric sans-serif which is modest and rather familiar. the other draws inspiration from the gothic architecture of medieval europe, specifically the pointed arches and patterns found in the tracery of gothic churches. hamhleypa is ‚Äúuniwidth‚Äù, which means that the letters of the typeface take up the same amount of space on either side of the axis. this makes hamhleypa ideal for the digital environment.`,
    nav: ["√≠sl"],
    labels: {
      ital: "style",
      tracking: "tracking",
      leading: "leading",
      color: "color",
      reset: "reset",
    }
  }
};



let currentSectionId = null;
    let currentLang = "is";
    function getTranslatedSectionTitle(sectionId, lang) {
  return translations[lang]?.dropdown?.[sectionId] || "Select Section";
}
function applyLanguage(lang) {
  const t = translations[lang];
  currentLang = lang;

  // ‚úÖ Get current section in view manually (no need to call updateDropdownTitle)
  const scrollY = snapContainer.scrollTop;
  const containerHeight = snapContainer.clientHeight;
  const middle = scrollY + containerHeight / 2;

 
let visibleSectionId = null;
document.querySelectorAll('section').forEach(section => {
  const top = section.offsetTop;
  const bottom = top + section.offsetHeight;
  if (middle >= top && middle < bottom) {
    visibleSectionId = section.id;
  }
});

// ‚úÖ Update the dropdown title based on visible section
if (visibleSectionId) {
  const translatedTitle = getTranslatedSectionTitle(visibleSectionId, lang);
  dropdownButton.innerHTML = `${translatedTitle} <span class="arrow">&#9660;</span>`;
}

  // ‚úÖ Proceed with rest of translation
  randomizeButton.textContent = t.hamleikur;
  sliderLabel.textContent = t.sliderLabel;
  document.querySelectorAll(".lang-switch").forEach((el) => {
  el.textContent = t.nav[0];
});

  textInput.setAttribute("data-placeholder", t.placeholder);

  if (
    textInput.innerText.trim() === "" ||
    textInput.innerText.trim() === translations["is"].placeholder ||
    textInput.innerText.trim() === translations["en"].placeholder
  ) {
    textInput.innerText = "";
  }

  document.querySelectorAll(".dropdown-item").forEach(item => {
    const sectionId = item.getAttribute("data-section");
    if (t.dropdown[sectionId]) {
      item.textContent = t.dropdown[sectionId];
    }
  });

  const labelMap = {
    "label-ital": t.labels.ital,
    "label-tracking": t.labels.tracking,
    "label-leading": t.labels.leading,
    "label-color": t.labels.color,
  };

  for (const id in labelMap) {
    const el = document.getElementById(id);
    if (!el) continue;
    if (id === "label-color") {
      el.textContent = labelMap[id];
    } else {
      el.childNodes[0].nodeValue = labelMap[id] + " ";
    }
  }
  document.body.setAttribute("data-lang", lang);

  document.getElementById("resetButton").textContent = t.labels.reset;

  const aboutWord = document.getElementById("aboutWord");
  aboutWord.innerHTML = "";
  buildAboutSentence(t.about);
  activateAboutHover(150);
  
  updateDropdownTitle();

}


    function switchImageInstant(imgElement, newSrc) {
  imgElement.src = newSrc;
}



// üëá Radius hover effect
const radiusWord = document.getElementById("radiusWord");
const sentence = "even as good shone upon the countenance of the one, evil was written broadly and plainly on the face of the other.";

function buildSentence(text) {
  const words = text.split(" ");
  words.forEach((word, i) => {
    const wordSpan = document.createElement("span");
    wordSpan.classList.add("word");
    wordSpan.style.display = "inline-block";
    wordSpan.style.whiteSpace = "nowrap";

    for (let char of word) {
      const charSpan = document.createElement("span");
      charSpan.classList.add("char");
      charSpan.textContent = char;
      wordSpan.appendChild(charSpan);
    }

    radiusWord.appendChild(wordSpan);
    if (i !== words.length - 1) {
      const space = document.createTextNode("\u00A0");
      radiusWord.appendChild(space);
    }
  });
}

function activateHoverEffect(radius = 120) {
  const chars = radiusWord.querySelectorAll(".char");

  radiusWord.addEventListener("mousemove", (e) => {
    const mouseX = e.clientX;
    const mouseY = e.clientY;

    chars.forEach((char) => {
      const rect = char.getBoundingClientRect();
      const charX = rect.left + rect.width / 2;
      const charY = rect.top + rect.height / 2;

      const dist = Math.sqrt((mouseX - charX) ** 2 + (mouseY - charY) ** 2);
      char.style.fontVariationSettings = dist < radius ? "'ital' 400" : "'ital' 1";
    });
  });
}


  const bigLetter = document.getElementById("bigLetter");
  const letterGrid = document.getElementById("letterGrid");

  const letters = [..."a√°bcd√∞e√©fghi√≠jklmno√≥pqrsstu√∫vwxy√Ωz√æ√¶√∂.,:;'!?-‚Äì‚Äî‚Äû‚Äú()"];

  function updateBigLetter(char) {
    bigLetter.textContent = char;
  }

  function renderLetterGrid() {
  letterGrid.innerHTML = ""; // Clear previous grid

  letters.forEach(char => {
    const cell = document.createElement("div");
    cell.className = "letter-cell";
    cell.textContent = char;

    // ‚úÖ Make "a" active by default
    if (char === "a") {
      cell.classList.add("active");
    }

    // Click listener to update big letter and active state
    cell.addEventListener("click", () => {
      updateBigLetter(char);
      document.querySelectorAll(".letter-cell").forEach(c => c.classList.remove("active"));
      cell.classList.add("active");
    });

    letterGrid.appendChild(cell);
  });

  // ‚úÖ Set bigLetter to "a" as default
  updateBigLetter("a");
}



  window.addEventListener("load", () => {
    renderLetterGrid();
  });

  document.addEventListener('DOMContentLoaded', function () {

  const dropdown = document.querySelector('.dropdown');
  const dropdownMenu = document.querySelector('.dropdown-menu');


  const sectionTitles = {
  'hero-section': 'heim',
  'about-hover-section': 'um hamhleypu',
  'glyph-section': 'leturs√Ωni',
  
};

// Close dropdown if user clicks outside of it
document.addEventListener('click', function (event) {
  const dropdown = document.querySelector('.dropdown');
  const isClickInside = dropdown.contains(event.target);

  if (!isClickInside) {
    dropdown.classList.remove('open');
  }
});

  // Toggle the dropdown visibility on click
  dropdownButton.addEventListener('click', function () {
    dropdown.classList.toggle('open');
  });

  // Add event listeners to dropdown items to scroll to sections
  document.querySelectorAll('.dropdown-item').forEach(item => {
    item.addEventListener('click', function () {
      const sectionId = this.getAttribute('data-section');
      const section = document.getElementById(sectionId);
      section.scrollIntoView({
        behavior: 'smooth',
        block: 'start'
      });

      // Close the dropdown after an item is selected
      dropdown.classList.remove('open');
    });
  });
 // Add the event listener outside of the toggleFontWeight function
// Select the button and the elements we want to update
const iconGlyphToggleFont = document.querySelector('.icon-glyph-toggle-font');
const bigLetter = document.getElementById('bigLetter');
const letterGrid = document.getElementById('letterGrid');

// Add the event listener for the button click
iconGlyphToggleFont.addEventListener('click', function() {
  console.log("Button clicked!");  // Check if the button is being clicked
  toggleFontWeight();  // Call the function to toggle font weight and switch the icon
});

// The function to toggle the font weight and switch the icon image
function toggleFontWeight() {
  const current = bigLetter.style.fontVariationSettings.includes('"ital" 400') ? 400 : 1;
  const newItal = current === 400 ? 1 : 400;

  bigLetter.style.fontVariationSettings = `"ital" ${newItal}`;
  letterGrid.querySelectorAll('.letter-cell').forEach(cell => {
    cell.style.fontVariationSettings = `"ital" ${newItal}`;
  });

  iconGlyphToggleFont.src = newItal === 400 
    ? 'icons/aregular_white.png' 
    : 'icons/agothic_white.png';
}



  // Listen for scroll events to update the title dynamically
  snapContainer.addEventListener('scroll', updateDropdownTitle);

  window.addEventListener('load', updateDropdownTitle);
  // Also run it on page load in case the page loads with a section already in view
  updateDropdownTitle();
});
function updateTextColorOnScroll() {
  const snapContainer = document.getElementById('snapContainer');
  const scrollY = snapContainer.scrollTop;
  const viewportHeight = snapContainer.clientHeight;

  const header = document.querySelector('.main-header');
  const navLinks = document.querySelectorAll('.nav-menu a');
  const langSwitch = document.querySelector('.lang-switch');
  const logoImg = document.getElementById('logoImg');

  const dropdownItems = document.querySelectorAll('.dropdown-item');


  const isQuiet = document.body.classList.contains('quiet-mode');
  const ital = parseInt(italicSlider.value, 10);
 

    let currentSection = null;
sections.forEach(section => {
  const top = section.offsetTop;
  const height = section.offsetHeight;
  const scrollMiddle = scrollY + viewportHeight / 2;

  // Only activate if scrollMiddle is at least 40% into the section
  if (scrollMiddle >= top + height * 0.4 && scrollMiddle <= top + height) {
    currentSection = section;
  }
});

  if (!currentSection) return;

  const isDark = currentSection.classList.contains('dark-bg');

  // Section-specific styles
  if (isDark) {
    header.style.color = '#d9d9d9';
    navLinks.forEach(link => link.style.color = '#d9d9d9');
    langSwitch.style.color = '#d9d9d9';
    document.querySelector('.logo-text').style.color = '#d9d9d9';
    dropdownButton.style.color = '#d9d9d9';
    dropdownItems.forEach(item => {
      item.style.color = '#121212';
      item.style.backgroundColor = '#d9d9d9';
    });
    document.body.classList.add('bg-dark');
  } else {
    header.style.color = '#121212';
    navLinks.forEach(link => link.style.color = '#121212');
    langSwitch.style.color = '#121212';
    document.querySelector('.logo-text').style.color = '#121212';
    dropdownButton.style.color = '#121212';
    dropdownItems.forEach(item => {
      item.style.color = '#8174C8';
      item.style.backgroundColor = 'transparent';
    });
    document.body.classList.remove('bg-dark');
  }

  // Overwrite with red if ital is 200‚Äì400 and not in quiet mode
  if (!isQuiet && ital >= 200 && ital <= 400) {
    header.style.color = '#F30600';
    navLinks.forEach(link => link.style.color = '#F30600');
    langSwitch.style.color = '#F30600';
    document.querySelector('.logo-text').style.color = '#F30600';
    dropdownButton.style.color = '#F30600';
    dropdownItems.forEach(item => {
      item.style.color = '#121212';
      item.style.backgroundColor = '#F30600';
    });
  }
}

const preview = document.getElementById('textPreview');
const italInput = document.getElementById('ital');
const trackingInput = document.getElementById('tracking');
const leadingInput = document.getElementById('leading');
const colorInput = document.getElementById('color');

function updatePreview() {
  preview.style.fontVariationSettings = `'ital' ${italInput.value}`;
  preview.style.letterSpacing = `${trackingInput.value}em`;
  preview.style.lineHeight = leadingInput.value;
  preview.style.color = colorInput.value;
}

[italInput, trackingInput, leadingInput, colorInput].forEach(input => {
  input.addEventListener('input', updatePreview);
});
preview.addEventListener('input', () => {
  updatePreview();
  fitTypePreview();
});
function fitTypePreview() {
  const el = document.getElementById("textPreview");
  const container = el.parentElement;

  const maxHeight = container.clientHeight;
  const maxWidth = container.clientWidth;

  // Clone the element off-screen for accurate measurement
  const clone = el.cloneNode(true);
  clone.style.position = 'absolute';
  clone.style.visibility = 'hidden';
  clone.style.whiteSpace = 'pre';
  clone.style.height = 'auto';
  clone.style.width = 'auto';
  clone.style.padding = getComputedStyle(el).padding;
  clone.style.lineHeight = getComputedStyle(el).lineHeight;
  clone.style.letterSpacing = getComputedStyle(el).letterSpacing;
  clone.style.fontFamily = getComputedStyle(el).fontFamily;
  clone.style.fontVariationSettings = getComputedStyle(el).fontVariationSettings;

  document.body.appendChild(clone);

  let fontSize = 400;

  while (fontSize > 24) {
    clone.style.fontSize = fontSize + 'px';
    if (clone.scrollWidth > maxWidth || clone.scrollHeight > maxHeight) {
      fontSize -= 2;
    } else {
      break;
    }
  }

  el.style.fontSize = fontSize + 'px';
  document.body.removeChild(clone);
}


function updatePlaceholderState() {
  if (preview.textContent.trim() === "") {
    preview.classList.add("empty");
  } else {
    preview.classList.remove("empty");
  }
}

// Clear placeholder on first focus
preview.addEventListener("focus", () => {
  if (preview.classList.contains("empty")) {
    preview.textContent = "";
    preview.classList.remove("empty");
  }
});

// Re-check on input/blur
preview.addEventListener("input", () => {
  updatePreview();
  updatePlaceholderState();
  fitTypePreview();
});

preview.addEventListener("blur", updatePlaceholderState);

// Initial state on load
window.addEventListener("DOMContentLoaded", updatePlaceholderState);

window.addEventListener("resize", fitTypePreview);
document.getElementById("resetButton").addEventListener("click", () => {
  // Reset sliders and color
  italInput.value = 1;
  trackingInput.value = 0;
  leadingInput.value = 1.5;
  colorInput.value = "#ffffff";

  // Reset preview text
  preview.textContent = "";
  preview.classList.add("empty");

  // Update styles
  updatePreview();
  fitTypePreview();
});


updatePreview();
fitTypePreview();



// Call it initially to set the correct color when the page loads
updateTextColorOnScroll();
updateIconsBasedOnState(); // ‚úÖ

const snapContainer = document.getElementById('snapContainer');
snapContainer.addEventListener('scroll', updateTextColorOnScroll);

buildSentence(sentence);
activateHoverEffect();

// üü¢ Initial setup AFTER everything is loaded
window.addEventListener("load", () => {
  fitTextToContainer();
  updateFont();
});

function fitTextToContainer() {
  const textInput = document.getElementById("textInput");
  if (!textInput) return;

  let fontSize = 160; // Big starting font size in pixels
  const minFontSize = 40; // Minimum allowed font size
  const textWrapper = document.querySelector('.text-wrapper'); // The parent container
  const maxHeight = textWrapper.clientHeight * 0.8; // 80% of textWrapper height

  textInput.style.fontSize = fontSize + "px"; // Set font size in pixels

  // Now adjust while too tall
  while (textInput.scrollHeight > maxHeight && fontSize > minFontSize) {
    fontSize -= 2; // Decrease font size slowly
    textInput.style.fontSize = fontSize + "px";
  }
}

toggleButton.addEventListener("click", () => {
  const current = parseInt(italicSlider.value, 10);
  const newItal = current <= 1 ? 400 : 1;


  console.log("Toggled to ital:", newItal);

  italicSlider.value = newItal;
italicSlider.dispatchEvent(new Event('input')); // üî• triggers all the logic already written

  updateFont();
  updateTextColorOnScroll();


  applyFontVariationToAllChildren(newItal);
  // üîç DEBUG: Check span ital values after toggle
const spans = textInput.querySelectorAll('span');
spans.forEach(span => {
  console.log(`[${span.textContent.trim()}] has ital:`, span.style.fontVariationSettings);
});

});





function forceLowercase(element) {
  element.addEventListener('input', () => {
    const selection = window.getSelection();
    const range = selection.getRangeAt(0);
    const caretOffset = range.startOffset;

    // Preserve current text, but convert just affected node's text to lowercase
    const original = element.innerText;
    const lower = original.toLowerCase();

    if (original !== lower) {
      element.textContent = lower;

      // Restore caret position
      const textNode = element.firstChild;
      if (textNode) {
        const offset = Math.min(caretOffset, textNode.length);
        const newRange = document.createRange();
        newRange.setStart(textNode, offset);
        newRange.collapse(true);
        selection.removeAllRanges();
        selection.addRange(newRange);
      }
    }

    // Update layout and placeholder
    if (element.id === 'textInput') {
      updatePlaceholder();
      fitTextSize();
    } else if (element.id === 'textPreview') {
      updatePlaceholderState();
      fitTypePreview();
    }
  });
}



// Apply to both fields
forceLowercase(document.getElementById('textInput'));
forceLowercase(document.getElementById('textPreview'));

['textInput', 'textPreview'].forEach(id => {
  const el = document.getElementById(id);
  el.addEventListener('paste', (e) => {
    e.preventDefault();
    const text = (e.clipboardData || window.clipboardData).getData('text');
    const lower = text.toLowerCase();
    document.execCommand('insertText', false, lower);
  });
});
document.addEventListener("DOMContentLoaded", function () {
  const hamburger = document.querySelector('.hamburger');
  const mobileMenu = document.querySelector('.mobile-menu');

  if (hamburger && mobileMenu) {
    hamburger.addEventListener('click', () => {
      mobileMenu.classList.toggle('show');
    });
  }
});



    </script>
  
    
</body>
</html>
